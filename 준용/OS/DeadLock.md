# 교착 상태

- `두 개 이상의 프로세스가 각자 가지고 있는 자원을 무한정 기다리는 상태`로, `어떠한 프로세스도 진행할 수 없는 상태`이다.

## 자원 할당 그래프

- 교착 상태의 상황을 한 눈에 보기 쉽게 그래프로 표현한 방법

### 표현 규칙

1. 프로세스는 원, 자원의 종류는 사각형으로 표현된다.
2. 자원의 개수는 사각형 내 점으로 표현된다.

   <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/f0de7f0a-6d40-4ed0-91f4-f69fc5ec4932" width=400>

4. 프로세스가 어떤 자원을 할당받아 사용 중이라면, 자원에서 프로세스를 향해 화살표를 표시한다.
5. 프로세스가 어떤 자원을 기다리고 있으면, 프로세스에서 자원으로 화살표를 표시한다.

    <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/12304c02-1405-4186-9e74-392c42c74921" width=400>
    
    

<aside>
💡 위의 규칙을 이용해 자원 할당 그래프를 그렸을 때, 원의 형태를 띄고 있다면 교착상태가 발생했을 가능성이 높다.
  
  <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/9bc07652-570a-481c-b59c-f6bb778f6dac" width=400>


</aside>

---

## 교착 상태 발생 조건과 예방 방안

- `상호 배제`, `점유와 대기`, `비선점형 스케줄링`, `원형 대기`의 조건을 모두 만족해야 교착상태가 발생한다.
    - 즉, 이 조건 중 하나라도 만족하지 못하면 교착 상태를 `예방`할 수 있다. → 하지만 모든 상황에 대한 예방은 어려움.
    - 또한 교착 상태를 `회피`하거나, `검출 후 회복`하는 방법도 있다.

### 상호 배제

- 교착 상태가 발생하는 근본적인 원인.
- 하나의 자원은 한 번에 하나의 프로세스만 이용 가능하기 때문.
- 하지만, 상호 배제 조건을 없앤다는 것은 모든 자원에 동시 접근을 허용하기 때문에, 현실적으로 어렵다.

### 점유와 대기

- 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태
- 점유와 대기를 없앤다면, 한 프로세스에 자원을 몰아줘야 하는데, 자원이 당장 필요한 프로세스일지라도 대기해야 할 수 있어 자원 활용률이 떨어진다.

### 비선점형 스케줄링

- 자원을 이용하는 프로세스의 작업이 끝나야만 다른 프로세스가 해당 자원을 이용할 수 있다.
- 비선점 조건을 없애면, 일부 자원 사용에 대해서는 효과적이다.
    - 하지만, 프린터 등의 입출력 작업을 선점형으로 처리하게 된다면 예상치 못한 문제가 발생할 수 있어 범용적인 해결책이 아니다.

### 원형 대기

- 자원 할당 그래프가 원의 형태로 그려지고, 프로세스들이 원의 형태로 자원을 대기하는 상태.
- 모든 자원에 번호를 붙여 오름차순으로 자원을 할당하는 등의 방법을 채택하면 일렬로 줄을 세울 수 있다.
    - 하지만, 모든 컴퓨터 시스템 내부의 자원에 번호를 매기는 것은 쉽지 않고, 어떤 자원에 우선순위가 높은 번호를 매기냐에 따라 자원 활용률이 떨어질 수 있다는 문제점이 있다.

---

## 교착 상태 회피

- 이 방식을 채택하는 이유는, 한정된 자원의 무분별한 할당에 의해 교착상태가 발생한다고 보기 때문이다.
- 따라서 교착 상태의 회피란, `프로세스들에 배분할 수 있는 자원의 양을 고려해 교착상태가 발생하지 않을 정도의 양만큼만 자원을 배분하는 방법`을 말한다.
- 교착 상태 회피 이해를 위한 최소 개념: `안전 상태`, `불안전 상태`, `안전 순서열`
    - **안전 상태:** 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
    - **불안전 상태:** 교착 상태가 발생할 수도 있는 상황
    - **안전 순서열:** 교착 상태 없이 안전하게 자원을 할당할 수 있는 순서. 즉, 안전 상태의 순서열.

---

## 교착 상태 검출 후 회복

- 교착 상태가 발생하는 것을 인정하고, 사후 조치하는 방식.
- 운영체제가 프로세스들이 자원을 요구할 때마다 모두 할당해주고, 교착 상태 발생 여부를 주기적으로 검사하는 방식이다.
- 교착상태가 검출되면 `선점` 또는 `프로세스 강제 종료`를 통해 회복한다.

### 선점을 통한 회복

- 교착상태가 해결될 때까지 다른 프로세스의 자원을 강제로 뺏고, 한 프로세스씩 자원을 몰아주는 방식.
    - 작업 내역을 잃는 프로세스를 최소화할 수 있지만, 교착 상태가 없어졌는지 확인하는 과정에서 오버헤드를 야기할 수 있다.

### 프로세스 강제 종료를 통한 회복

- 교착 상태에 놓인 프로세스를 모두 강제 종료하는 방식.
    - 확실하게 교착 상태에서 벗어날 수 있지만, 많은 프로세스의 작업 내역을 잃게 된다.
