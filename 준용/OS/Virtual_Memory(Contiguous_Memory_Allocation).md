# 가상 메모리

- 실행하고자 하는 프로그램을 일부만 메모리에 적재해 실제 물리 메모리보다 큰 프로세스를 실행할 수 있게 해주는 기술
- 가상 메모리 관리 기법에는 크게 `페이징` 과 `세그멘테이션` 이 있으나, 오늘날에는 `페이징` 기법을 많이 사용한다.
- 이러한 가상 메모리 기법이 등장하게 된 배경(연속 메모리 할당의 문제)를 설명한 뒤, 가상 메모리 관리 기법에 대해 정리하겠다.

## 논리 주소, 물리 주소

- 주소 공간을 크게 논리 주소와 물리 주소로 구분할 수 있다.
    |분류|설명|
    | --- | --- |
    | 논리 주소(Logical address) | CPU가 생성하는 주소로, 가상 주소라고도 부른다. |
    | 물리 주소(Physical address) | 메인 메모리(RAM)에서의 주소로, 실제 데이터가 저장된 하드웨어상의 주소를 말한다. |
- 프로그램 실행 중에는 논리 주소를 물리 주소로 변환(Mapping)해야 하며, 이 작업을 MMU(Memory Management Unit)이 담당한다. MMU는 내부에 재배치 레지스터(Relocation Register)가 존재하며, 이에 대한 설명은 후술하겠다.
    <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/b40f19a5-266f-42cf-a2fe-e3d8c0fce892" width=500>
    
    - 재배치 레지스터가 가지고 있는 값 + 논리 주소를 더해 물리 주소가 된다.
    - 즉, 사용자 프로그램은 실질적으로 물리주소에 접근하지 않으며, 논리 주소만을 사용한다.

---

## 연속 메모리 할당

- 프로세스에 연속적인 메모리 공간을 할당하는 방식

  <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/24e478a6-206d-441f-9c8c-7b9626084a35" width=300>


### 스와핑

- `메모리에 적재된 프로세스 중 현재 실행되지 않는 프로세스를 보조기억장치로 보내고, 이를 통해 생긴 메모리의 빈 공간에 다른 프로세스를 적재하여 실행하는 방식`으로, 프로세스들이 요구하는 메모리 공간의 크기가 실제 메모리 공간보다 크더라도 프로세스들을 동시에 실행할 수 있게 만들어준다.

  <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/8753e024-096d-44a9-8105-8192b23f5ac7" width=500>

- **스왑 영역(swap space):** 보조기억장치로 보내진 프로세스가 있는 영역
- **스왑 아웃(swap-out):** 현재 실행되지 않는 프로세스를 보조기억장치로 옮기는 것
- **스왑 인(swap-in):** 스왑 영역의 프로세스를 다시 메모리로 가져오는 것

### 메모리 할당

- 메모리 할당 방식에는 대표적으로 `최초 적합`, `최적 적합`, `최악 적합`이 있다.
    
    <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/01e81746-add9-4da4-befd-f0a07fc4ac5d" width=500>

- 최초 적합: 프로세스가 적재될 수 있는 공간 발견 시 즉시 메모리를 할당하는 방식으로, 검색을 최소화하여 빠른 할당이 가능하다.
- 최적 적합: 프로세스가 적재될 수 있는 가장 작은 공간에 프로세스를 배치하는 방식
- 최악 적합: 프로세스가 적재될 수 있는 가장 큰 공간에 프로세스를 배치하는 방식

### 문제점 ( 외부 단편화 현상 )

- 프로세스를 할당하기 어려울 만큼 작은 메모리 공간들로 인해 메모리가 낭비되는 현상.
    
  <img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/8a08b949-f4ab-4bc7-80e8-076a1db2a394" width=300>


### 해결 방안

- 외부 단편화를 해결하는 방안으로, `압축`, `페이징`, `세그멘테이션` 등이 있으나, 현재는 페이징 기법을 많이 사용한다.
<img src="https://github.com/JUNY0110/Weekly-I-Learned/assets/98405970/d6fc0e3f-55e5-45cd-8194-7a51408d6d31" width=500>

- 압축은 과거에 많이 사용했지만, 현재는 잘 사용하지 않으므로, 간단히 설명하고 넘어가겠다.
    - 압축은 흔히 디스크 조각 모음이라고 부르던 방식이며, **작은 빈 공간들을 하나로 모아 큰 공간으로 만드는 방법**이다.
    - 하지만, 작은 빈 공간들을 하나로 모으는 동안 **시스템은 하던 일을 중지**해야 하며, 메모리에 있는 내용을 옮기는 작업은 **많은 오버헤드를 발생**시킨다.
    - 또한, 어떤 프로세스를 어떻게 움직여야 오버헤드를 최소화하며 압축이 가능한 지 명확한 방법을 결정하기 어렵다.
    - 이러한 이유로 페이징 기법을 많이 사용하게 된다.
